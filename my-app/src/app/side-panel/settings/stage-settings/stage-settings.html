<table class="table">
  <thead>
    <tr>
      <th>Order</th>
      <th>Stage</th>
      <th>Description</th>
      <th>Payment (%)</th>
    </tr>
  </thead>
  <tbody>
    <tr *ngFor="let s of stages" [ngClass]="{ 'text-muted': !isMain(s) }">
      <td>{{ s.orderIndex }}</td>
      <td [style.padding-left.px]="!isMain(s) ? 20 : 0">
        {{ s.name }}
      </td>
      <td>{{ s.description }}</td>
      <td>
        <input type="number"
               class="form-control text-end"
               [(ngModel)]="s.paymentPercentage"
               [disabled]="!isMain(s)"
               (input)="updateTotal()"
               min="0" max="100" />
      </td>
    </tr>
  </tbody>
  <tfoot>
    <tr>
      <th colspan="3" class="text-end">Total</th>
      <th [ngClass]="{ 'text-danger': totalPercentage !== 100, 'text-success': totalPercentage === 100 }">
        {{ totalPercentage }}%
      </th>
    </tr>
  </tfoot>
</table>

<!-- Remaining percentage indicator -->
<div class="text-end mt-2">
  <small [ngClass]="{
          'text-danger': totalPercentage > 100 || totalPercentage < 100,
          'text-success': totalPercentage === 100
        }">
    Remaining: {{ 100 - totalPercentage }}%
  </small>
</div>


<div class="text-end mt-3">
  <button class="btn btn-primary" [disabled]="saving || totalPercentage !== 100" (click)="saveChanges()">
    {{ saving ? 'Saving...' : 'Save Changes' }}
  </button>
</div>
